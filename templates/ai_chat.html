{% extends "base.html" %}

{% block title %}AI Assistant - Life360 Dashboard{% endblock %}

{% block content %}
<div class="ai-chat-container">
    <!-- Header -->
    <div class="ai-header">
        <div class="ai-header-content">
            <h1 class="ai-title">
                <span class="ai-icon">ü§ñ</span>
                AI Assistant
            </h1>
            <p class="ai-subtitle">Your intelligent data analyst for Life360 Dashboard</p>
        </div>
        <div class="ai-header-actions">
            <button type="button" class="ai-btn ai-btn-secondary" onclick="loadQuickStats()">
                <span class="ai-btn-icon">üìä</span>
                Quick Stats
            </button>
            <button type="button" class="ai-btn ai-btn-outline" onclick="clearChat()">
                <span class="ai-btn-icon">üóëÔ∏è</span>
                Clear Chat
            </button>
        </div>
    </div>

    <!-- Quick Stats Panel -->
    <div class="ai-stats-panel" id="quickStatsPanel" style="display: none;">
        <div class="ai-stats-content" id="quickStatsContent">
            <div class="ai-loading">
                <div class="ai-spinner"></div>
                <span>Loading statistics...</span>
            </div>
        </div>
    </div>

    <!-- Chat Interface -->
    <div class="ai-chat-card">
        <div class="ai-chat-header">
            <div class="ai-chat-title">
                <span class="ai-chat-icon">üí¨</span>
                Ask AI About Your Data
            </div>
            <div class="ai-chat-subtitle">Get instant insights about your stock, orders, and practitioners</div>
        </div>
        
        <div class="ai-chat-body">
            <!-- Chat Messages -->
            <div class="ai-messages" id="chatMessages">
                <div class="ai-message ai-message-bot">
                    <div class="ai-message-avatar">
                        <span class="ai-avatar-icon">ü§ñ</span>
                    </div>
                    <div class="ai-message-content">
                        <div class="ai-message-text">
                            <p>Hello! I'm your AI assistant for the Life360 Dashboard. I can help you with questions about:</p>
                            <div class="ai-capabilities">
                                <div class="ai-capability">
                                    <span class="ai-capability-icon">üì¶</span>
                                    <div class="ai-capability-text">
                                        <strong>Stock Management</strong>
                                        <span>Current levels, expiring items, low stock alerts</span>
                                    </div>
                                </div>
                                <div class="ai-capability">
                                    <span class="ai-capability-icon">üìã</span>
                                    <div class="ai-capability-text">
                                        <strong>Orders</strong>
                                        <span>Status, completion rates, customer information</span>
                                    </div>
                                </div>
                                <div class="ai-capability">
                                    <span class="ai-capability-icon">üë©‚Äç‚öïÔ∏è</span>
                                    <div class="ai-capability-text">
                                        <strong>Practitioners</strong>
                                        <span>Onboarding status, contact info, provider affiliations</span>
                                    </div>
                                </div>
                                <div class="ai-capability">
                                    <span class="ai-capability-icon">üìà</span>
                                    <div class="ai-capability-text">
                                        <strong>Analytics</strong>
                                        <span>Performance metrics, trends, and insights</span>
                                    </div>
                                </div>
                            </div>
                            <div class="ai-suggestion">
                                <span class="ai-suggestion-icon">üí°</span>
                                <span>Try asking: <em>"How many orders are pending?"</em> or <em>"Show me low stock items"</em></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Chat Input -->
            <div class="ai-input-section">
                <form id="chatForm" class="ai-input-form">
                    <div class="ai-input-container">
                        <input type="text" class="ai-input" id="chatInput" placeholder="Ask me anything about your data..." autocomplete="off">
                        <button class="ai-send-btn" type="submit" id="sendButton">
                            <span class="ai-send-icon">‚úàÔ∏è</span>
                        </button>
                    </div>
                </form>
                <div class="ai-examples">
                    <span class="ai-examples-icon">üí°</span>
                    <span class="ai-examples-text">
                        <strong>Examples:</strong> "How many practitioners are onboarded?", "What's our stock situation?", "Show me pending orders"
                    </span>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
/* Modern AI Chat Styles */
.ai-chat-container {
    width: 100vw;
    margin: -1rem calc(-50vw + 50%); /* Full width with base template compensation */
    padding: 20px;
    min-height: calc(100vh - 120px);
    background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
    box-sizing: border-box;
    overflow-x: hidden;
    position: relative;
}

/* Header Styles */
.ai-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
    padding: 20px 0;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    text-align: center;
}

.ai-header-content {
    flex: 1;
}

.ai-title {
    font-size: 2.5rem;
    font-weight: 700;
    color: #fff;
    margin: 0 0 8px 0;
    display: flex;
    align-items: center;
    gap: 12px;
}

.ai-icon {
    font-size: 2.2rem;
    filter: drop-shadow(0 0 10px rgba(59, 130, 246, 0.5));
}

.ai-subtitle {
    color: rgba(255, 255, 255, 0.7);
    font-size: 1.1rem;
    margin: 0;
    font-weight: 400;
}

.ai-header-actions {
    display: flex;
    gap: 12px;
}

.ai-btn {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 12px 20px;
    border: none;
    border-radius: 12px;
    font-weight: 600;
    font-size: 0.95rem;
    cursor: pointer;
    transition: all 0.3s ease;
    text-decoration: none;
}

.ai-btn-secondary {
    background: linear-gradient(135deg, #3b82f6, #1d4ed8);
    color: white;
    box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
}

.ai-btn-secondary:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
}

.ai-btn-outline {
    background: transparent;
    color: rgba(255, 255, 255, 0.8);
    border: 2px solid rgba(255, 255, 255, 0.2);
}

.ai-btn-outline:hover {
    background: rgba(255, 255, 255, 0.1);
    color: white;
    border-color: rgba(255, 255, 255, 0.3);
}

.ai-btn-icon {
    font-size: 1.1rem;
}

/* Stats Panel */
.ai-stats-panel {
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.04));
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 16px;
    padding: 20px;
    margin-bottom: 20px;
    backdrop-filter: blur(10px);
}

.ai-stats-content {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
}

.ai-loading {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    color: rgba(255, 255, 255, 0.7);
    padding: 40px;
}

.ai-spinner {
    width: 24px;
    height: 24px;
    border: 3px solid rgba(255, 255, 255, 0.3);
    border-top: 3px solid #3b82f6;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Chat Card */
.ai-chat-card {
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.04));
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 20px;
    backdrop-filter: blur(10px);
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
    overflow: hidden;
    width: 100%;
}

.ai-chat-header {
    padding: 24px 24px 16px 24px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0.02));
}

.ai-chat-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: #fff;
    margin: 0 0 8px 0;
    display: flex;
    align-items: center;
    gap: 12px;
}

.ai-chat-icon {
    font-size: 1.3rem;
}

.ai-chat-subtitle {
    color: rgba(255, 255, 255, 0.6);
    font-size: 0.95rem;
    margin: 0;
}

.ai-chat-body {
    display: flex;
    flex-direction: column;
    height: 70vh;
    max-height: 600px;
    min-height: 400px;
}

/* Messages */
.ai-messages {
    flex: 1;
    padding: 20px 24px;
    overflow-y: auto;
    scroll-behavior: smooth;
}

.ai-message {
    display: flex;
    gap: 20px;
    margin-bottom: 32px;
    animation: fadeInUp 0.4s ease-out;
}

.ai-message-user {
    flex-direction: row-reverse;
}

.ai-message-avatar {
    width: 56px;
    height: 56px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}

.ai-message-bot .ai-message-avatar {
    background: linear-gradient(135deg, #3b82f6, #1d4ed8);
    box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
}

.ai-message-user .ai-message-avatar {
    background: linear-gradient(135deg, #10b981, #059669);
    box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
}

.ai-avatar-icon {
    font-size: 1.8rem;
    color: white;
}

.ai-message-content {
    flex: 1;
    max-width: 90%;
    margin: 0 auto;
}

.ai-message-user .ai-message-content {
    text-align: right;
}

.ai-message-text {
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 20px;
    padding: 24px 28px;
    color: #fff;
    line-height: 1.7;
    backdrop-filter: blur(10px);
    font-size: 1.05rem;
}

.ai-message-user .ai-message-text {
    background: linear-gradient(135deg, #3b82f6, #1d4ed8);
    border-color: rgba(59, 130, 246, 0.3);
}

.ai-message-text p {
    margin: 0 0 16px 0;
    font-size: 1.1rem;
}

.ai-message-text p:last-child {
    margin-bottom: 0;
}

/* Capabilities */
.ai-capabilities {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 24px;
    margin: 28px 0;
    justify-items: center;
}

.ai-capability {
    display: flex;
    align-items: center;
    gap: 14px;
    padding: 20px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 16px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    width: 100%;
    max-width: 350px;
    transition: all 0.3s ease;
}

.ai-capability:hover {
    background: rgba(255, 255, 255, 0.08);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
}

.ai-capability-icon {
    font-size: 1.4rem;
    width: 36px;
    text-align: center;
}

.ai-capability-text {
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.ai-capability-text strong {
    color: #fff;
    font-size: 1rem;
    font-weight: 600;
}

.ai-capability-text span {
    color: rgba(255, 255, 255, 0.7);
    font-size: 0.9rem;
    line-height: 1.4;
}

/* Suggestion */
.ai-suggestion {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-top: 16px;
    padding: 12px 16px;
    background: rgba(59, 130, 246, 0.1);
    border: 1px solid rgba(59, 130, 246, 0.2);
    border-radius: 12px;
    color: rgba(255, 255, 255, 0.9);
    font-size: 0.9rem;
}

.ai-suggestion-icon {
    font-size: 1rem;
}

/* Input Section */
.ai-input-section {
    padding: 20px 24px;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0.02));
}

.ai-input-form {
    margin-bottom: 12px;
}

.ai-input-container {
    display: flex;
    gap: 12px;
    align-items: center;
    width: 100%;
}

.ai-input {
    flex: 1;
    padding: 16px 20px;
    border: 2px solid rgba(255, 255, 255, 0.1);
    border-radius: 16px;
    background: rgba(255, 255, 255, 0.05);
    color: #fff;
    font-size: 1rem;
    backdrop-filter: blur(10px);
    transition: all 0.3s ease;
}

.ai-input:focus {
    outline: none;
    border-color: #3b82f6;
    box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
    background: rgba(255, 255, 255, 0.08);
}

.ai-input::placeholder {
    color: rgba(255, 255, 255, 0.5);
}

.ai-send-btn {
    width: 56px;
    height: 56px;
    border: none;
    border-radius: 16px;
    background: linear-gradient(135deg, #3b82f6, #1d4ed8);
    color: white;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
}

.ai-send-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
}

.ai-send-btn:active {
    transform: translateY(0);
}

.ai-send-icon {
    font-size: 1.2rem;
}

.ai-examples {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    color: rgba(255, 255, 255, 0.6);
    font-size: 0.85rem;
    text-align: center;
    width: 100%;
}

.ai-examples-icon {
    font-size: 1rem;
}

.ai-examples-text strong {
    color: rgba(255, 255, 255, 0.8);
}

/* Loading Animation */
.ai-loading-message {
    display: flex;
    align-items: center;
    gap: 12px;
    color: rgba(255, 255, 255, 0.7);
    font-style: italic;
}

.ai-loading-dots {
    display: inline-block;
}

.ai-loading-dots::after {
    content: '';
    animation: dots 1.5s infinite;
}

@keyframes dots {
    0%, 20% { content: ''; }
    40% { content: '.'; }
    60% { content: '..'; }
    80%, 100% { content: '...'; }
}

/* Animations */
@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Stat Cards */
.ai-stat-card {
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.04));
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 16px;
    padding: 20px;
    display: flex;
    align-items: center;
    gap: 16px;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.ai-stat-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
}

.ai-stat-icon {
    width: 56px;
    height: 56px;
    border-radius: 16px;
    background: linear-gradient(135deg, #3b82f6, #1d4ed8);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
}

.ai-stat-content {
    flex: 1;
}

.ai-stat-number {
    font-size: 2rem;
    font-weight: 700;
    color: #fff;
    line-height: 1;
    margin-bottom: 4px;
}

.ai-stat-label {
    font-size: 0.9rem;
    color: rgba(255, 255, 255, 0.7);
    margin-bottom: 8px;
}

.ai-stat-details {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
}

.ai-stat-badge {
    padding: 4px 8px;
    border-radius: 8px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.ai-stat-success {
    background: rgba(16, 185, 129, 0.2);
    color: #10b981;
    border: 1px solid rgba(16, 185, 129, 0.3);
}

.ai-stat-warning {
    background: rgba(245, 158, 11, 0.2);
    color: #f59e0b;
    border: 1px solid rgba(245, 158, 11, 0.3);
}

.ai-stat-danger {
    background: rgba(239, 68, 68, 0.2);
    color: #ef4444;
    border: 1px solid rgba(239, 68, 68, 0.3);
}

.ai-stat-secondary {
    background: rgba(107, 114, 128, 0.2);
    color: #6b7280;
    border: 1px solid rgba(107, 114, 128, 0.3);
}

.ai-error-message {
    background: rgba(239, 68, 68, 0.1);
    border: 1px solid rgba(239, 68, 68, 0.2);
    border-radius: 12px;
    padding: 16px;
    color: #ef4444;
    text-align: center;
    font-weight: 500;
}

.ai-message-error {
    background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(239, 68, 68, 0.1)) !important;
    border-color: rgba(239, 68, 68, 0.3) !important;
}

/* Responsive Design */
@media (max-width: 1200px) {
    .ai-chat-container {
        padding: 16px;
    }
    
    .ai-chat-body {
        height: 65vh;
        max-height: 500px;
    }
}

@media (max-width: 768px) {
    .ai-chat-container {
        padding: 12px;
    }
    
    .ai-header {
        flex-direction: column;
        gap: 16px;
        align-items: center;
        text-align: center;
    }
    
    .ai-title {
        font-size: 1.8rem;
    }
    
    .ai-header-actions {
        width: 100%;
        justify-content: center;
        flex-wrap: wrap;
        gap: 8px;
    }
    
    .ai-btn {
        padding: 10px 16px;
        font-size: 0.9rem;
    }
    
    .ai-message-content {
        max-width: 90%;
    }
    
    .ai-capabilities {
        grid-template-columns: 1fr;
        justify-items: center;
    }
    
    .ai-capability {
        max-width: 100%;
    }
    
    .ai-stat-card {
        flex-direction: column;
        text-align: center;
    }
    
    .ai-stat-details {
        justify-content: center;
    }
    
    .ai-chat-body {
        height: 60vh;
        max-height: 450px;
        min-height: 350px;
    }
    
    .ai-input-container {
        flex-direction: column;
        gap: 8px;
        width: 100%;
    }
    
    .ai-send-btn {
        width: 100%;
        height: 48px;
    }
    
    .ai-examples {
        flex-direction: column;
        text-align: center;
        gap: 4px;
    }
}

@media (max-width: 480px) {
    .ai-chat-container {
        padding: 8px;
    }
    
    .ai-chat-body {
        height: 55vh;
        min-height: 300px;
    }
    
    .ai-messages {
        padding: 16px;
    }
    
    .ai-input-section {
        padding: 16px;
    }
}
</style>

<script>
let chatHistory = [];

document.addEventListener('DOMContentLoaded', function() {
    const chatForm = document.getElementById('chatForm');
    const chatInput = document.getElementById('chatInput');
    const chatMessages = document.getElementById('chatMessages');
    const sendButton = document.getElementById('sendButton');

    chatForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const message = chatInput.value.trim();
        if (message) {
            sendMessage(message);
            chatInput.value = '';
        }
    });

    chatInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            chatForm.dispatchEvent(new Event('submit'));
        }
    });

    function sendMessage(message) {
        // Add user message
        addMessage(message, 'user');
        
        // Show loading
        const loadingId = addLoadingMessage();
        
        // Send to AI
        fetch('/api/ask_ai', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ prompt: message })
        })
        .then(response => response.json())
        .then(data => {
            removeLoadingMessage(loadingId);
            
            if (data.ok) {
                addMessage(data.answer, 'ai');
            } else {
                addMessage(`Error: ${data.error}`, 'ai', true);
            }
        })
        .catch(error => {
            removeLoadingMessage(loadingId);
            addMessage(`Network error: ${error.message}`, 'ai', true);
        });
    }

    function addMessage(content, sender, isError = false) {
        const messageDiv = document.createElement('div');
        messageDiv.className = `ai-message ai-message-${sender}`;
        
        const avatarIcon = sender === 'ai' ? 'ü§ñ' : 'üë§';
        const messageClass = isError ? 'ai-message-error' : '';
        
        messageDiv.innerHTML = `
            <div class="ai-message-avatar">
                <span class="ai-avatar-icon">${avatarIcon}</span>
            </div>
            <div class="ai-message-content">
                <div class="ai-message-text ${messageClass}">
                    ${formatMessage(content)}
                </div>
            </div>
        `;
        
        chatMessages.appendChild(messageDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;
        
        chatHistory.push({ content, sender, timestamp: new Date() });
    }

    function addLoadingMessage() {
        const loadingId = 'loading-' + Date.now();
        const messageDiv = document.createElement('div');
        messageDiv.id = loadingId;
        messageDiv.className = 'ai-message ai-message-bot';
        
        messageDiv.innerHTML = `
            <div class="ai-message-avatar">
                <span class="ai-avatar-icon">ü§ñ</span>
            </div>
            <div class="ai-message-content">
                <div class="ai-message-text">
                    <div class="ai-loading-message">
                        <span>Thinking</span>
                        <span class="ai-loading-dots"></span>
                    </div>
                </div>
            </div>
        `;
        
        chatMessages.appendChild(messageDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;
        
        return loadingId;
    }

    function removeLoadingMessage(loadingId) {
        const loadingElement = document.getElementById(loadingId);
        if (loadingElement) {
            loadingElement.remove();
        }
    }

    function formatMessage(content) {
        // Basic formatting for better readability
        return content
            .replace(/\n/g, '<br>')
            .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
            .replace(/\*(.*?)\*/g, '<em>$1</em>');
    }

    function clearChat() {
        chatMessages.innerHTML = `
            <div class="ai-message ai-message-bot">
                <div class="ai-message-avatar">
                    <span class="ai-avatar-icon">ü§ñ</span>
                </div>
                <div class="ai-message-content">
                    <div class="ai-message-text">
                        <p>Chat cleared. How can I help you today?</p>
                    </div>
                </div>
            </div>
        `;
        chatHistory = [];
    }

    // Load quick stats
    function loadQuickStats() {
        const panel = document.getElementById('quickStatsPanel');
        const content = document.getElementById('quickStatsContent');
        
        if (panel.style.display === 'none') {
            panel.style.display = 'block';
            
            fetch('/api/ai_stats')
                .then(response => response.json())
                .then(data => {
                    if (data.ok) {
                        content.innerHTML = formatQuickStats(data.stats);
                    } else {
                        content.innerHTML = `<div class="alert alert-warning">${data.error}</div>`;
                    }
                })
                .catch(error => {
                    content.innerHTML = `<div class="alert alert-danger">Error loading stats: ${error.message}</div>`;
                });
        } else {
            panel.style.display = 'none';
        }
    }

    function formatQuickStats(stats) {
        if (stats.error) {
            return `<div class="ai-error-message">${stats.error}</div>`;
        }

        return `
            <div class="ai-stat-card">
                <div class="ai-stat-icon">üìã</div>
                <div class="ai-stat-content">
                    <div class="ai-stat-number">${stats.orders.total}</div>
                    <div class="ai-stat-label">Orders</div>
                    <div class="ai-stat-details">
                        <span class="ai-stat-badge ai-stat-success">${stats.orders.completed} Completed</span>
                        <span class="ai-stat-badge ai-stat-warning">${stats.orders.pending} Pending</span>
                    </div>
                </div>
            </div>
            <div class="ai-stat-card">
                <div class="ai-stat-icon">üë©‚Äç‚öïÔ∏è</div>
                <div class="ai-stat-content">
                    <div class="ai-stat-number">${stats.practitioners.total}</div>
                    <div class="ai-stat-label">Practitioners</div>
                    <div class="ai-stat-details">
                        <span class="ai-stat-badge ai-stat-success">${stats.practitioners.onboarded} Onboarded</span>
                        <span class="ai-stat-badge ai-stat-secondary">${stats.practitioners.pending} Pending</span>
                    </div>
                </div>
            </div>
            <div class="ai-stat-card">
                <div class="ai-stat-icon">üì¶</div>
                <div class="ai-stat-content">
                    <div class="ai-stat-number">${stats.stock.total_units}</div>
                    <div class="ai-stat-label">Stock Units</div>
                    <div class="ai-stat-details">
                        <span class="ai-stat-badge ai-stat-danger">${stats.stock.low_stock_items.length} Low Stock</span>
                        <span class="ai-stat-badge ai-stat-warning">${stats.stock.expiring_items.length} Expiring</span>
                    </div>
                </div>
            </div>
        `;
    }

    // Make functions globally available
    window.loadQuickStats = loadQuickStats;
    window.clearChat = clearChat;
});
</script>
{% endblock %}
